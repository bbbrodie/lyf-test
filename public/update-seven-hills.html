<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <title>Update Your Details - Lyf 24/7</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            box-sizing: border-box;
        }

        .logo {
            width: 100px;
            height: auto;
            object-fit: contain;
        }

        .title {
            font-size: 2.5em;
            margin: 20px 0;
            text-align: center;
        }

        .form-container {
            background-color: #111;
            padding: 30px;
            border-radius: 10px;
            width: 90%; /* Mobile-first: full width */
            text-align: left;
            max-width: 500px; /* Limit on larger screens */
        }

        .section-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 10px;
            flex-direction: column; /* Mobile-first: stack vertically */
        }

        .form-row > div {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-size: 1em;
            color: #fff;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            background-color: #222;
            border: none;
            border-radius: 20px;
            color: #fff;
            font-size: 1em;
            box-sizing: border-box;
        }

        textarea {
            resize: none;
            height: 200px;
            overflow-y: auto;
        }

        select {
            appearance: none;
        }

        .date-input {
            position: relative;
        }

        .date-input input {
            padding-right: 30px;
        }

        .date-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #888;
            font-size: 1.2em;
        }

        .radio-group {
            display: flex;
            gap: 20px;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #fff;
        }

        .checkbox-group {
            margin-top: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .note {
            color: #ffcc00;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .submit {
            background-color: rgb(227, 25, 54);
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 1em;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }

        .error-message {
            color: red;
            font-size: 0.9em;
            margin-top: 10px;
            display: none;
        }

        #card-element {
            background-color: #222;
            padding: 10px;
            border-radius: 20px;
            margin-top: 10px;
        }

        footer {
            margin-top: 50px;
            padding-bottom: 20px;
            text-align: center;
        }

        footer .logo {
            margin: 0 auto;
            display: block;
        }

        .legal {
            margin-top: 10px;
            color: #888;
            font-size: 0.8em;
        }

        .legal a {
            color: #888;
            text-decoration: none;
            margin: 0 5px;
        }

        /* Responsive Media Queries */
        @media (min-width: 600px) {
            .form-container {
                width: 500px;
            }

            .form-row {
                flex-direction: row;
            }
        }

        @media (max-width: 599px) {
            input, select, textarea {
                padding: 12px;
                font-size: 1.1em;
            }

            button {
                padding: 12px 20px;
            }
        }

        #successPopup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #111;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 1001;
            text-align: center;
            color: #fff;
        }
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        button:disabled { background: gray; }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-17280409330"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'AW-17280409330');
    </script>
    <!-- Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <header>
        <a href="/index.html"><img src="logo.png" alt="Lyf24/7 Logo" class="logo"></a>
    </header>
<h1 class="title">Membership Agreement<br><span id="location-title"></span></h1>
    <form class="form-container">
        <div class="section-title">Personal Information</div>
        <div class="form-group">
            <div class="form-row">
                <div>
                    <label for="first-name">First Name *</label>
                    <input type="text" id="first-name" placeholder="First name" required>
                </div>
                <div>
                    <label for="last-name">Last Name *</label>
                    <input type="text" id="last-name" placeholder="Last name" required>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="form-row">
                <div>
                    <label for="dob">Date Of Birth *</label>
                    <div class="date-input">
                        <input type="date" id="dob" placeholder="Date of birth" required>
                        <span class="date-icon">ðŸ—“</span>
                    </div>
                </div>
                <div>
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" placeholder="Phone" required>
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" placeholder="Email" required>
        </div>
        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address" placeholder="Address">
        </div>
        <div class="form-group">
            <div class="form-row">
                <div>
                    <label for="state">State</label>
                    <select id="state">
                        <option value="" selected disabled>State</option>
                        <option value="NSW">NSW</option>
                        <option value="VIC">VIC</option>
                        <option value="QLD">QLD</option>
                        <option value="SA">SA</option>
                        <option value="WA">WA</option>
                        <option value="TAS">TAS</option>
                        <option value="NT">NT</option>
                        <option value="ACT">ACT</option>
                    </select>
                </div>
                <div>
                    <label for="city">City</label>
                    <input type="text" id="city" placeholder="City">
                </div>
                <div>
                    <label for="postcode">Postcode</label>
                    <input type="text" id="postcode" placeholder="Postcode">
                </div>
            </div>
        </div>
        <div class="section-title">Emergency Contact</div>
        <div class="form-group">
            <div class="form-row">
                <div>
                    <label for="emergency-first">First Name</label>
                    <input type="text" id="emergency-first" placeholder="First name">
                </div>
                <div>
                    <label for="emergency-last">Last Name</label>
                    <input type="text" id="emergency-last" placeholder="Last name">
                </div>
            </div>
        </div>
        <div class="form-group">
            <label for="emergency-phone">Phone Number</label>
            <input type="tel" id="emergency-phone" placeholder="Phone">
        </div>
        <div class="section-title">Membership Agreement</div>
        <div class="form-group">
            <textarea id="membership-text" readonly>I understand and acknowledge that the exercise programs, personal training sessions, exercising, the use of exercising equipment and physical activity including but not limited to unsupervised use, weightlifting, walking, boxing, running and use of various conditioning and exercise equipment involves the risk of injury. I understand and accept the risks of injury, including heart attacks, muscle strains, pulls or tears, broken bones, shin splints, heat prostration, knee/lower back injuries, back and foot injuries, repetitive strain injuries and the like which might arise from an exercise program or the use of exercise and/or conditioning equipment and similar facilities.

I have answered all of the questions correctly and to the best of my knowledge. I also understand that this information may be used as a guide only for a Personal Trainer to assess my current health status, and that any assessment does not replace the advice, recommendation or practice of a general medical practitioner. I acknowledge that it is my ultimate responsibility to ensure I am capable of completing any prescribed exercise without harm. If I have any impairment/s or medical condition/s or am requested by a Lyf 24/7 team member, I agree to seek the advice of a general medical practitioner to ensure I am capable of starting and maintaining an exercise program and I will provide the general medical practitioner with all information, including that provided by Lyf 24/7 or my Personal Trainer, relating to the nature of the exercise program, personal training sessions, physical activity or exercise equipment.

You acknowledge and agree that Lyf 24/7 may do any act necessary to comply with, or which it is specifically authorised to do by legislation, including but not limited to, work health and safety legislation. To this end, Lyf 24/7 may be required to:

a) Undertake a specific risk assessment for the purposes of identifying any hazards and minimising any risks which may arise from you using the Club facilities; and/or

b) Conduct further orientation sessions with you for the purposes of communicating and informing you of any hazards and any control measures which have been or will be put in place to ensure, so far as is reasonably practical, your health and safety and the health and safety of others.

You acknowledge and agree that while Lyf 24/7 is doing any of these acts, your access to the facilities may be limited or restricted.



Member Acknowledgment:

PLEASE SIGN BELOW TO ACKNOWLEDGE YOUR ACCEPTANCE OF THE RELEASE AND INDEMNITY PROVISION IN LYF 24/7's TERMS AND CONDITIONS.

BY ACCEPTING THIS AGREEMENT I ACKNOWLEDGE THAT I HAVE READ AND UNDERSTOOD THE LYF 24/7's TERMS AND CONDITIONS. BY ACCEPTING THIS AGREEMENT I ALSO AGREE TO ACCEPT THE TERMS OF THIS AGREEMENT IN ITS ENTIRETY AND TO BE BOUND BY THE CONDITIONS FOR THE DURATION OF MY MEMBERSHIP.



This is an ongoing agreement. The agreement will continue until either you or Lyf 24/7 terminate it in the way described in the Lyf 24/7 Terms and Conditions. If an automatic debit arrangement is in place, membership fees will continue to be debited from your credit card or bank account until you notify Lyf 24/7 to cancel this arrangement.

Your ongoing fortnightly fee will be the same as it was at the time of signing; if you're currently paying $37.90 per fortnight, then you will continue paying $37.90 under this agreement.
</textarea>
            <div class="checkbox-group">
                <label><input type="checkbox" id="agree-membership" required> I have read and agree to the Membership Agreement *</label>
            </div>
        </div>
        <div class="section-title">Medical Waiver (PAR-Q)</div>
        <div class="form-group">
            <p>Please answer the following questions honestly to assess your readiness for physical activity.</p>
            <div class="form-group">
                <label>1. Has your doctor ever said that you have a heart condition and that you should only do physical activity recommended by a doctor? *</label>
                <div class="radio-group">
                    <label><input type="radio" name="parq1" value="yes" required> Yes</label>
                    <label><input type="radio" name="parq1" value="no"> No</label>
                </div>
            </div>
            <div class="form-group">
                <label>2. Do you feel pain in your chest when you do physical activity? *</label>
                <div class="radio-group">
                    <label><input type="radio" name="parq2" value="yes" required> Yes</label>
                    <label><input type="radio" name="parq2" value="no"> No</label>
                </div>
            </div>
            <div class="form-group">
                <label>3. In the past month, have you had chest pain when you were not doing physical activity? *</label>
                <div class="radio-group">
                    <label><input type="radio" name="parq3" value="yes" required> Yes</label>
                    <label><input type="radio" name="parq3" value="no"> No</label>
                </div>
            </div>
            <div class="form-group">
                <label>4. Do you lose your balance because of dizziness or do you ever lose consciousness? *</label>
                <div class="radio-group">
                    <label><input type="radio" name="parq4" value="yes" required> Yes</label>
                    <label><input type="radio" name="parq4" value="no"> No</label>
                </div>
            </div>
            <div class="form-group">
                <label>5. Do you have a bone or joint problem (for example, back, knee or hip) that could be made worse by a change in your physical activity? *</label>
                <div class="radio-group">
                    <label><input type="radio" name="parq5" value="yes" required> Yes</label>
                    <label><input type="radio" name="parq5" value="no"> No</label>
                </div>
            </div>
            <div class="form-group">
                <label>6. Is your doctor currently prescribing drugs (for example, water pills) for your blood pressure or heart condition? *</label>
                <div class="radio-group">
                    <label><input type="radio" name="parq6" value="yes" required> Yes</label>
                    <label><input type="radio" name="parq6" value="no"> No</label>
                </div>
            </div>
            <div class="form-group">
                <label>7. Do you know of any other reason why you should not do physical activity? *</label>
                <div class="radio-group">
                    <label><input type="radio" name="parq7" value="yes" required> Yes</label>
                    <label><input type="radio" name="parq7" value="no"> No</label>
                </div>
            </div>
            <div id="parq-note" class="note" style="display: none;">If you answered YES to one or more questions, please consult your doctor before becoming more physically active.</div>
            <div class="checkbox-group">
                <label><input type="checkbox" id="agree-medical" required> I confirm the above information is correct and accept any associated risks *</label>
            </div>
        </div>
        <div class="section-title">Signature</div>
        <div class="form-group">
            <label for="signature">Signature (type your full name) *</label>
            <input type="text" id="signature" placeholder="Type your full name" required>
        </div>
        <div class="form-group">
            <label for="sign-date">Date *</label>
            <input type="date" id="sign-date" required disabled>
        </div>

                <!-- New switcher for BECS and Card -->

    <div class="section-title">Update Payment Details</div>
    <div class="form-group">
        <label>Payment Method *</label>
        <div class="radio-group">
            <label><input type="radio" name="payment-type" value="card" checked> Credit Card</label>
            <label><input type="radio" name="payment-type" value="becs"> Bank Account (BECS Direct Debit)</label>
        </div>
    </div>
    <div class="form-group" id="payment-element-container">
        <label id="payment-label">Card Information</label>
        <div id="payment-element"></div>
        <div id="payment-errors" class="error-message"></div>
    </div>
    <div id="becs-mandate" class="note" style="display: none; margin-top: 10px;">By providing your bank account details and confirming this payment, you authorise Lyf 24/7 and Stripe, our payment service provider, to send instructions to your bank to debit your account in accordance with the terms of your membership. You are entitled to a refund from your bank under the terms and conditions of your agreement with your bank. A refund must be claimed within 8 weeks starting from the date on which your account was debited. Please contact us for more details.</div>

    <div id="error-message" class="error-message">Please fill in all required fields.</div>
    <button class="submit" id="submitBtn">Submit Update</button>
    <p class="note" style="margin-top: 20px; font-size: 0.9em;">By submitting, you agree your data will be handled per our <a href="/privacy.html" style="color: #888;">Privacy Policy</a>. Bank details are securely processed via Stripe; other info is sent for CRM update.</p>

            <!-- End New Switcher -->
</form>

    <footer>
        <img src="logo.png" alt="Lyf24/7 Logo" class="logo">
        <div class="legal">
            <a href="/privacy.html">Privacy Policy</a> Â© 2025 Lyf 24/7 is a trading name of BKAJ Fitness Pty Ltd. All rights reserved. <a href="/terms.html">Terms and Conditions</a>
        </div>
    </footer>

    <div id="overlay"></div>
    <div id="successPopup">
        <h2>Success!</h2>
        <p>Update submitted successfully!</p>
        <button onclick="closePopup()">OK</button>
    </div>

<script>
        // Fetch publishable key based on location
        async function fetchPubKey(location) {
            try {
                const normalizedLocation = location.replace(/-/g, '');
                const response = await fetch(`/get-pub-key?location=${encodeURIComponent(normalizedLocation)}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch publishable key');
                }
                const data = await response.json();
                return data.publishableKey;
            } catch (error) {
                document.getElementById('error-message').textContent = 'Error loading payment system: ' + error.message;
                document.getElementById('error-message').style.display = 'block';
                return null;
            }
        }

        (async () => {
            // Location from URL
            const path = window.location.pathname;
            const gymLocation = path.includes('update-') ? path.split('update-')[1].split('.html')[0] : '';
            let formattedLocation = gymLocation.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
            document.getElementById('location-title').textContent = formattedLocation ? `at ${formattedLocation}` : '';

            // Fetch pub key
            const pubKey = await fetchPubKey(gymLocation);
            if (!pubKey) {
                // Hide payment section if key fails
                const paymentSection = document.querySelector('.section-title:last-of-type');
                if (paymentSection) paymentSection.style.display = 'none';
                document.getElementById('payment-element-container').style.display = 'none';
                return;
            }

            // Stripe setup
            const stripe = Stripe(pubKey);
            const elements = stripe.elements();

            // Create both elements upfront
            const cardElement = elements.create('card', {
                hidePostalCode: true,
                style: {
                    base: {
                        color: '#fff',
                        fontFamily: 'sans-serif',
                        fontSize: '16px',
                        '::placeholder': {
                            color: '#888',
                        }
                    }
                }
            });

            const becsElement = elements.create('auBankAccount', {
                style: {
                    base: {
                        color: '#fff',
                        fontFamily: 'sans-serif',
                        fontSize: '16px',
                        '::placeholder': {
                            color: '#888',
                        }
                    }
                }
            });

            // Function to switch payment element
            function switchPaymentElement(type) {
                const label = document.getElementById('payment-label');
                const mandate = document.getElementById('becs-mandate');
                const errors = document.getElementById('payment-errors');

                // Unmount if mounted
                if (type === 'card' && cardElement._componentName === 'card') {
                    becsElement.unmount();
                    cardElement.mount('#payment-element');
                    label.textContent = 'Card Information';
                    mandate.style.display = 'none';
                } else if (type === 'becs' && becsElement._componentName === 'auBankAccount') {
                    cardElement.unmount();
                    becsElement.mount('#payment-element');
                    label.textContent = 'Bank Account Information (BSB and Account Number)';
                    mandate.style.display = 'block';
                }
                errors.textContent = '';
                errors.style.display = 'none';
            }

            // Initial: card
            cardElement.mount('#payment-element');

            // Listen for payment type change
            document.querySelectorAll('input[name="payment-type"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    switchPaymentElement(e.target.value);
                });
            });

            // Payment element error listener
            const handlePaymentChange = (event) => {
                const errors = document.getElementById('payment-errors');
                if (event.error) {
                    errors.textContent = event.error.message;
                    errors.style.display = 'block';
                } else {
                    errors.textContent = '';
                    errors.style.display = 'none';
                }
            };
            cardElement.on('change', handlePaymentChange);
            becsElement.on('change', handlePaymentChange);

            // Set signature date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('sign-date').value = today;

            // PAR-Q dynamic note
            const parqRadios = document.querySelectorAll('input[type="radio"][name^="parq"]');
            parqRadios.forEach(radio => {
                radio.addEventListener('change', () => {
                    const yesAnswers = Array.from(parqRadios).filter(r => r.value === 'yes' && r.checked).length;
                    document.getElementById('parq-note').style.display = yesAnswers > 0 ? 'block' : 'none';
                });
            });

            // Submit handler
            document.querySelector('.submit').addEventListener('click', async (event) => {
                event.preventDefault();
                const button = event.target;
                button.textContent = 'Submitting...';
                button.disabled = true; // Disable to prevent double submit
                const form = document.querySelector('.form-container');
                if (!form.checkValidity()) {
                    document.getElementById('error-message').style.display = 'block';
                    button.textContent = 'Submit Update';
                    button.disabled = false;
                    return;
                }

                // Collect data
                const data = {
                    location: gymLocation.toLowerCase().replace(/-/g, ''),
                    firstName: document.getElementById('first-name').value,
                    lastName: document.getElementById('last-name').value,
                    dob: document.getElementById('dob').value,
                    phone: document.getElementById('phone').value,
                    email: document.getElementById('email').value,
                    address: document.getElementById('address').value,
                    state: document.getElementById('state').value,
                    city: document.getElementById('city').value,
                    postcode: document.getElementById('postcode').value,
                    emergencyFirst: document.getElementById('emergency-first').value,
                    emergencyLast: document.getElementById('emergency-last').value,
                    emergencyPhone: document.getElementById('emergency-phone').value,
                    agreeMembership: document.getElementById('agree-membership').checked,
                    parqAnswers: {
                        q1: document.querySelector('input[name="parq1"]:checked')?.value,
                        q2: document.querySelector('input[name="parq2"]:checked')?.value,
                        q3: document.querySelector('input[name="parq3"]:checked')?.value,
                        q4: document.querySelector('input[name="parq4"]:checked')?.value,
                        q5: document.querySelector('input[name="parq5"]:checked')?.value,
                        q6: document.querySelector('input[name="parq6"]:checked')?.value,
                        q7: document.querySelector('input[name="parq7"]:checked')?.value
                    },
                    agreeMedical: document.getElementById('agree-medical').checked,
                    signature: document.getElementById('signature').value,
                    signDate: today,
                    paymentMethodId: null
                };

                // Handle Stripe if payment details entered
                const paymentType = document.querySelector('input[name="payment-type"]:checked')?.value;
                if (paymentType) {
                    const paymentKey = paymentType === 'card' ? 'card' : 'au_becs_debit';
                    const paymentElem = paymentType === 'card' ? cardElement : becsElement;
                    const {error, paymentMethod} = await stripe.createPaymentMethod({
                        type: paymentType === 'card' ? 'card' : 'au_becs_debit',
                        [paymentKey]: paymentElem,
                        billing_details: {
                            name: `${data.firstName} ${data.lastName}`,
                            email: data.email,
                            address: {
                                line1: data.address,
                                city: data.city,
                                state: data.state,
                                postal_code: data.postcode,
                                country: 'AU'
                            }
                        }
                    });

                    if (error) {
                        document.getElementById('payment-errors').textContent = error.message;
                        document.getElementById('payment-errors').style.display = 'block';
                        button.textContent = 'Submit Update';
                        button.disabled = false;
                        return;
                    } else if (paymentMethod) {
                        data.paymentMethodId = paymentMethod.id;
                    }
                }

                // Send to backend
                try {
                    const response = await fetch('/send-update', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    if (!response.ok) throw new Error('Failed to submit update.');
                    document.getElementById('overlay').style.display = 'block';
                    document.getElementById('successPopup').style.display = 'block';
                    document.getElementById('error-message').style.display = 'none';
                } catch (err) {
                    document.getElementById('error-message').textContent = 'Error: ' + err.message;
                    document.getElementById('error-message').style.display = 'block';
                    button.textContent = 'Submit Update';
                    button.disabled = false;
                }
            });

            // Mobile detection
            function isMobile() {
                return window.matchMedia("(max-width: 599px)").matches;
            }
            if (isMobile()) {
                document.body.classList.add('mobile');
                document.querySelectorAll('input, select').forEach(el => el.style.padding = '15px');
            }
            window.addEventListener('resize', () => {
                if (isMobile()) {
                    document.body.classList.add('mobile');
                } else {
                    document.body.classList.remove('mobile');
                }
            });
        })();

        function closePopup() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('successPopup').style.display = 'none';
            // Optionally reset button
            const button = document.getElementById('submitBtn');
            button.textContent = 'Submit Update';
            button.disabled = false;
        }
</script>
</body>
</html>
